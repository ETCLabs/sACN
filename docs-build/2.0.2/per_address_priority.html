<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>sACN: Per Address Priority</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="etcdevtool.css" rel="stylesheet" type="text/css"/>
<!-- BEGIN CUSTOM SCRIPTS -->
<!-- BEGIN ETCDEVTOOL VERSION SELECTOR SCRIPT -->
<script type="text/javascript">
  $(function () {
    $.get('/sACNDocs/versions.txt', function (data) {
      if (data) {
        var lines = data.split('\n');
        if (lines.length > 0) {
          var version_select = $("#version_select").empty();
          lines.forEach(function (line) {
            line = line.trim();
            if (!line) {
              return;
            }
            line = line.split(':');
            var option_name = line[0].replace(/^v/, '');
            if (line.length > 1) {
              option_name += ' (' + line[1] + ')';
            }
            var option_val = '/sACNDocs/' + line[0];
            var option = $('<option></option>').attr("value", option_val)
              .text(option_name);
            if (window.location.pathname.match(line[0])) {
              option = option.attr("selected", "selected");
            }
            version_select.append(option);
          });
        }
      }
    }, 'text');
  });
</script>
<!-- END ETCDEVTOOL VERSION SELECTOR SCRIPT -->
<script type="text/javascript">
  $(function () { selectAllC() });
</script>
<script type="text/javascript">
  function selectAllC() {
    // Enable all C-language blocks
    var tabcontent = document.getElementsByClassName("code-tab-content");
    for (i = 0; i < tabcontent.length; i++) {
      if (tabcontent[i].id.endsWith("_c")) {
        tabcontent[i].style.display = "block";
      } else {
        tabcontent[i].style.display = "none"
      }
    }
    // Enable all C-language buttons
    var tablinks = document.getElementsByClassName("code-tab-links");
    for (i = 0; i < tablinks.length; i++) {
      if (tablinks[i].id.endsWith("_c")) {
        if (!tablinks[i].className.includes("active")) {
          tablinks[i].className = tablinks[i].className += " active";
        }
      } else {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
    }
  }
  function selectAllCpp() {
    // Enable all C++-language blocks
    var tabcontent = document.getElementsByClassName("code-tab-content");
    for (i = 0; i < tabcontent.length; i++) {
      if (tabcontent[i].id.endsWith("_cpp")) {
        tabcontent[i].style.display = "block";
      } else {
        tabcontent[i].style.display = "none"
      }
    }
    // Enable all C++-language buttons
    var tablinks = document.getElementsByClassName("code-tab-links");
    for (i = 0; i < tablinks.length; i++) {
      if (tablinks[i].id.endsWith("_cpp")) {
        if (!tablinks[i].className.includes("active")) {
          tablinks[i].className = tablinks[i].className += " active";
        }
      } else {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
    }
  }
  function selectLanguage(evt, block_id, language) {
    // Get all elements with class="tabcontent" and hide them
    var tabcontent = document.getElementsByClassName("code-tab-content");
    for (i = 0; i < tabcontent.length; i++) {
      if (tabcontent[i].id.startsWith("div_" + block_id)) {
        tabcontent[i].style.display = "none";
      }
    }
    // Get all elements with class="tablinks" and remove the class "active"
    var tablinks = document.getElementsByClassName("code-tab-links");
    for (i = 0; i < tablinks.length; i++) {
      if (tablinks[i].id.startsWith("button_" + block_id)) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
    }
    // Show the current tab, and add an "active" class to the button that opened the tab
    document.getElementById("div_" + block_id + "_" + language).style.display = "block";
    if (!evt.currentTarget.className.includes("active")) {
      evt.currentTarget.className += " active";
    }
  }
</script>
<!-- END CUSTOM SCRIPTS -->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">sACN
   &#160;<span id="projectnumber">2.0.2</span>
   </div>
   <div id="projectbrief">Implementation of ANSI E1.31 (Streaming ACN)</div>
  </td>
  <!-- BEGIN VERSION SELECTOR INSERTED BY ETCDEVTOOL -->
  <td style="text-align: right; padding-right: 0.5em">
    <div id="otherversions">
      View other versions:
      <select id="version_select" onchange="location = this.value">
      </select>
    </div>
  </td>
  <!-- END VERSION SELECTOR INSERTED BY ETCDEVTOOL -->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('per_address_priority.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Per Address Priority </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__tmp_tmpyc0x8t09_docs_pages_per_address_priority"></a>The sACN protocol specification details DMX-style control over TCP/IP networks. While this provides a fast and efficient mechanism to transport the well-understood DMX protocol, it also introduces a problem that may not be as well-understood by the industry: multiple sources. Unlike DMX over RS485, multiple sources may easily provide overlapping sets of universe data, and may only be interested in controlling subsections of different universes.</p>
<p>While sACN has a priority field in the packet, this does not cover cases where a controller wants to explicitly control a small subsection of values without disturbing the rest – and HTP doesn’t help when that controller wants to force a subset of the values to a lower DMX level.</p>
<p>To better handle multiple source control scenarios, the 0xDD sACN start code was obtained by ETC from ESTA to allow setting a priority per-address, with the option of having DMX levels for a particular address ignored by a receiver. This provides a more versatile and finer resolution priority mechanism over the sACN provided packet priority. This document details how sACN devices implementing this extension will use this start code.</p>
<h1>Document Conventions</h1>
<p>The following acronyms and terms are used:</p><ul>
<li><em>sACN</em>, <em>Streaming ACN</em>, <em>Streaming DMX</em>: Reference "BSR E1.31 DMX512-A Streaming Protocol"</li>
<li><em>Receiver</em>: A device that receives sACN</li>
<li><em>Source</em>: A device that sends sACN. Sources are uniquely identified by their CID.</li>
<li><em>DMX level(s)</em>: Property values associated with a Null START code data packet.</li>
<li><em>HTP</em>: Highest Takes Precedence: The source with the highest level will have control.</li>
<li><em>Packet priority field</em>: Value of priority field in an sACN packet.</li>
<li><em>Packet options field</em>: Value of options field in an sACN packet.</li>
<li><em>Universe</em>: A collection of 512 values, corresponding to a DMX universe.</li>
<li><em>Address</em>: A single value in the universe, also known as a channel.</li>
<li><em>Universal Hold Last Look Time</em>: Configurable time after which source loss behavior will take effect.</li>
<li><em>Source loss Behavior</em>: Action taken by a receiver to a DMX level in the absence of a controlling source. This is typically<ul>
<li>Assume 0</li>
<li>Fade to 0</li>
<li>Hold last known level for a preconfigured time (could be forever)</li>
<li>Fade to some predetermined level</li>
<li>Disable port or something similar as determined by the manufacture of the receiver.</li>
</ul>
</li>
</ul>
<h1>Rules for using the 0xDD start code</h1>
<ol type="1">
<li>Devices will support per-address priority via the alternate start code 0xDD, which will be used to identify the sACN packet as carrying "per-address priority" values and not DMX levels.</li>
<li>The rules apply on a per universe basis where a receiver is receiving sACN packets for the same universe from different sources.</li>
<li>Per-address priority values consist of a series of single byte values indicating the source’s desired priority for the corresponding DMX level. Priority values can be set from 0 to 200 where 200 is the highest priority and 1 is the lowest priority. Priority values 201 thru 255 are reserved for the receiver to use as internal priorities.</li>
<li>A priority value of 0 indicates that the DMX level from the source is to be ignored by the receiver.</li>
<li>The final value at an address is taken from the source with highest priority. If there is more than one source with the same highest priority, HTP shall be applied between sources.</li>
<li>If a 0xDD packet is received with less than 512 values, the missing values are assumed to be 0 (DMX level ignored);</li>
<li>Per-address priorities for sources that do not send 0xDD packets will be taken from the packet priority field.</li>
<li>The source follows the sACN rules for non-changing data for 0xDD packets as well, so a change of priorities for a universe is sent for 3 extra frames and then sent once every 800-1000ms.</li>
<li>When a source wants to take control of an address, it should set desired DMX level and then set the per-address priority to a non-0 value.</li>
<li>When a source wants to give up control of an address, it should set the per-address priority to zero. It is recommended to also set the DMX level to zero, because setting a priority to zero may result in source loss behavior for the corresponding address if there is no other source that gets control.</li>
<li>For some compatibility with receivers that don’t support the 0xDD packets, sources sending 0xDD packets shall also provide a packet priority value that applies to all addresses. The default value for this priority shall be 100. This allows for packet priority and HTP control between sources.</li>
<li>When a receiver detects a new source, it waits for a 0xDD packet for up to 1.5 seconds before processing DMX levels from that source. If a receiver does not detect a 0xDD packet, it falls back and uses the packet priority until a 0xDD packet is detected. <br  />
</li>
<li>When a receiver detects that a source has reached the sACN source loss timeout for 0xDD packets (e.g. no 0xDD packets in Universal Hold Last Look Time&ndash;2.5 seconds at minimum), but is still receiving NULL start code packets, the receiver shall fall back to using the sACN packet priority located in the NULL start code packets.</li>
<li>When a receiver detects that a source has reached the sACN source loss timeout for NULL start code packets (e.g. no NULL start code packets in the Universal Hold Last Look Time&ndash;2.5 seconds at minimum) the receiver shall act as if the source has given up control of its addresses as stated in 4.16 even if 0xDD packets continue to be received. <br  />
 The desired sequence for a source to terminate its sACN stream is to send three NULL start code packets with the Stream_Terminated bit (6) of the Packet options field set to 1. This will allow the device with the next highest priority to gain control after the appropriate sampling time resolution.</li>
<li>When a receiver detects that a source has given up control of an address (by setting the priority for that address to 0), the receiver will give control to the source with next highest priority. If no source is available, source loss behavior for that address shall apply.</li>
</ol>
<h1>Summary</h1>
<p>In summary, priority may be specified on a per packet basis in sACN. This ETC extension allows priorities to be provided on a per-address basis using the alternate start code of 0xDD.</p>
<p>With this extension, taking control is accomplished by setting a non-zero priority for an address. Giving up control is the reverse, setting the priority to 0.</p>
<p>Overall, receivers wait for a short period on start up to see if the alternate start code priority information is being provided before they start accepting data.</p>
<p>If no alternate start code priority information arrives, they use the packet priority. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="additional_documentation.html">Additional Documentation</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
